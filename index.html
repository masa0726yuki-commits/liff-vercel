<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>おしょバド★プロフィール登録</title>
  <!-- LINE LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: "Noto Sans JP", sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 24px;
      color: #222;
    }
    .card {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.1);
      padding: 24px;
    }
    h1 {
      text-align: center;
      font-size: 20px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }
    button {
      width: 100%;
      background: #06c755;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 16px;
      margin-top: 22px;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .status {
      text-align: center;
      margin-top: 15px;
      font-weight: 600;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="card">
    <h1>プロフィール登録／更新</h1>
    <form id="profileForm">
      <label>ニックネーム</label>
      <input type="text" id="nickname" required>

      <label>本名</label>
      <input type="text" id="realname" required>

      <label>電話番号</label>
      <input type="tel" id="phone" required>

      <label>性別</label>
      <select id="gender" required>
        <option value="">選択してください</option>
        <option value="男性">男性</option>
        <option value="女性">女性</option>
        <option value="その他">その他</option>
      </select>

      <label>バドミントンのレベル</label>
      <select id="level" required>
        <option value="">選択してください</option>
        <option value="初級">初級</option>
        <option value="中級">中級</option>
        <option value="上級">上級</option>
      </select>

      <label><input type="checkbox" id="rental"> ラケットレンタル希望</label>

      <button type="submit">更新</button>
    </form>
    <div id="status" class="status"></div>
  </div>

  <script>
    // === 設定エリア ===
    const LIFF_ID = "2008326025-1LYV0A5o"; // あなたのLIFF ID
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbzE_sWMucN_QMnncHdCRNpzOfJdb5EcRcRbVYOAPfT4E5RrhjCiM6dVabYBPfp5sa2PEA/exec";

    // === 初期化 ===
    async function initLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        const profile = await liff.getProfile();
        document.querySelector("#nickname").value = profile.displayName || "";
        document.querySelector("#status").innerText = `${profile.displayName} さん、ようこそ！`;
      } catch (e) {
        console.error("LIFF初期化エラー:", e);
        document.querySelector("#status").innerText = "LIFF初期化に失敗しました。";
      }
    }

    // === フォーム送信 ===
    document.getElementById("profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      try {
        const p = await liff.getProfile();
        const data = {
          userId: p.userId,
          displayName: p.displayName,
          nickname: document.getElementById("nickname").value,
          realname: document.getElementById("realname").value,
          phone: document.getElementById("phone").value,
          gender: document.getElementById("gender").value,
          level: document.getElementById("level").value,
          rental: document.getElementById("rental").checked ? "希望" : "なし"
        };

        const res = await fetch(ENDPOINT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const text = await res.text();
        if (res.ok && text.includes("OK")) {
          document.getElementById("status").innerText = "✅ 登録／更新が完了しました！";
          document.getElementById("status").className = "status success";
        } else {
          document.getElementById("status").innerText = "⚠️ 登録エラー：" + text;
          document.getElementById("status").className = "status error";
        }
      } catch (err) {
        console.error("送信エラー:", err);
        document.getElementById("status").innerText = "❌ 通信エラー：" + err.message;
        document.getElementById("status").className = "status error";
      }
    });

    // === 実行 ===
    initLiff();
  </script>
</body>
</html>
